<!-- pages/diet/food-select.wxml -->
<view class="container">
  <!-- 搜索栏 -->
  <view class="search-bar">
    <van-search
      value="{{ searchValue }}"
      placeholder="搜索食材"
      bind:change="onSearchChange"
      bind:search="onSearch"
    />
  </view>

  <!-- 分类标签 -->
  <view class="category-tabs">
    <scroll-view scroll-x class="tabs-scroll" enable-flex>
      <view 
        class="tab-item {{activeCategory === item.id ? 'active' : ''}}"
        wx:for="{{categories}}"
        wx:key="id"
        bindtap="switchCategory"
        data-id="{{item.id}}"
      >
        {{item.name}}
      </view>
    </scroll-view>
  </view>

  <!-- 食材列表 -->
  <scroll-view scroll-y class="food-list" enable-flex>
    <block wx:if="{{foods.length > 0}}">
      <view class="food-item" wx:for="{{foods}}" wx:key="id" bindtap="selectFood" data-food="{{item}}">
        <view class="food-info">
          <image class="food-image" src="{{item.image}}" mode="aspectFill" />
          <view class="food-detail">
            <text class="food-name">{{item.name}}</text>
            <view class="nutrition-info">
              <text class="calories">{{item.calories}}千卡/{{item.unit}}</text>
              <text class="protein">蛋白质{{item.nutrition.protein}}g</text>
              <text class="carbs">碳水{{item.nutrition.carbs}}g</text>
              <text class="fat">脂肪{{item.nutrition.fat}}g</text>
            </view>
          </view>
        </view>
        <van-icon name="arrow" />
      </view>
    </block>
    <view wx:else class="empty-tip">
      <van-icon name="search" size="48px" color="#999"/>
      <text>未找到相关食材</text>
    </view>
  </scroll-view>

  <!-- 食材数量选择弹窗 -->
  <van-popup
    show="{{ showAmountDialog }}"
    position="bottom"
    bind:close="onAmountClose"
    round
  >
    <view class="amount-dialog">
      <view class="dialog-header">
        <text>设置数量</text>
        <van-icon name="cross" bind:click="onAmountClose" />
      </view>
      <view class="dialog-content">
        <view class="selected-food">
          <text class="food-name">{{selectedFood.name}}</text>
          <text class="unit-text">单位：{{selectedFood.unit}}</text>
        </view>
        <view class="amount-input">
          <van-stepper
            value="{{ amount }}"
            min="0.1"
            max="1000"
            step="0.1"
            decimal-length="{{ 1 }}"
            bind:change="onAmountChange"
          />
        </view>
        <view class="nutrition-preview">
          <text class="preview-title">营养成分预览</text>
          <view class="preview-content">
            <text class="calories">{{calculatedCalories}}千卡</text>
            <text class="protein">蛋白质 {{calculatedNutrition.protein}}g</text>
            <text class="carbs">碳水 {{calculatedNutrition.carbs}}g</text>
            <text class="fat">脂肪 {{calculatedNutrition.fat}}g</text>
          </view>
        </view>
      </view>
      <view class="dialog-footer">
        <van-button type="primary" block bind:click="confirmAmount">确认添加</van-button>
      </view>
    </view>
  </van-popup>
</view> 